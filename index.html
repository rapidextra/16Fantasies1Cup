<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>16 Fantasies 1 Cup ‚Äì Weekly Cup‚ÄëDates</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Teko:wght@600;700&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f1318; --ink:#e9eef6; --muted:#9aa7b6; --panel:#181e25; --line:#2a3340; --accent:#f6c453;}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:var(--ink)}
    .font-header{font-family:Teko,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:0 6px 28px rgba(0,0,0,.25);position:relative;overflow:hidden}
    a.card:hover{border-color:var(--accent); box-shadow:0 8px 30px rgba(246,196,83,.15)}
    .badge{position:absolute;top:10px;right:-34px;transform:rotate(35deg);background:var(--accent);color:#0b1020;font-weight:800;font-size:.7rem;padding:.3rem 3rem;border:1px solid #caa24b}
    .playoff-team{display:flex;align-items:center;padding:8px;background-color:rgba(255,255,255,0.03);border-radius:6px;}
    .playoff-seed{font-size:14px;font-weight:900;width:24px;height:24px;display:flex;align-items:center;justify-content:center;border-radius:50%;margin-right:12px;}
    .seed-1{background-color:#F6C453;color:#111;} .seed-2{background-color:#A0AEC0;color:#111;}
    .seed-3{background-color:#975A16;color:white;} .seed-4{background-color:#4A5568;color:white;}
  </style>
</head>
<body class="min-h-screen p-6 sm:p-10">
  <main class="mx-auto max-w-6xl space-y-10">
    <header class="text-center space-y-2">
      <img src="./images/league-logo.png" alt="League Logo" class="mx-auto w-24 h-auto mb-2">
      <h1 class="font-header text-5xl sm:text-6xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-slate-200 via-yellow-400 to-yellow-600">
        üèÜ 16 Fantasies 1 Cup
      </h1>
      <p class="text-slate-400">All Weekly Cup‚ÄëDates ¬∑ Archives ¬∑ Poll receipts</p>
    </header>

    <section class="card p-6">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <div class="flex-1">
          <h2 class="font-header text-2xl sm:text-3xl font-bold text-yellow-400 mb-4">Bend The Knee Playoff Picture</h2>
          <div id="btk-playoffs" class="space-y-2">
            </div>
        </div>

        <div class="flex-1">
          <h2 class="font-header text-2xl sm:text-3xl font-bold text-blue-400 mb-4">Finkle Laces Out Playoff Picture</h2>
          <div id="flo-playoffs" class="space-y-2">
            </div>
        </div>

        <div class="flex-1">
          <h2 class="font-header text-2xl sm:text-3xl font-bold text-[color:var(--accent)] mb-4">‚ö° Season Highlights</h2>
          <div id="season-highlights" class="space-y-3">
            </div>
        </div>
      </div>
    </section>

    <section class="space-y-4">
      <h2 class="font-header text-3xl sm:text-4xl font-bold text-center text-[color:var(--accent)]">Weekly Cup‚ÄëDates</h2>
      <div id="weeks" class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
        </div>
    </section>

  </main>

  <script src="weeks.js"></script>
  <script>
    function populatePlayoffs(standings) {
        const btkContainer = document.getElementById('btk-playoffs');
        const floContainer = document.getElementById('flo-playoffs');

        if (!btkContainer || !floContainer || !standings) return;

        const btkTeams = standings.filter(t => t.Division === 'BTK').slice(0, 4);
        const floTeams = standings.filter(t => t.Division === 'FLO').slice(0, 4);

        btkContainer.innerHTML = btkTeams.map((team, index) => `
            <div class="playoff-team">
                <div class="playoff-seed seed-${index + 1}">${index + 1}</div>
                <div>
                    <div class="font-semibold text-sm">${team.Owner}</div>
                    <div class="text-xs text-slate-400">${team.record}</div>
                </div>
            </div>
        `).join('');

        floContainer.innerHTML = floTeams.map((team, index) => `
            <div class="playoff-team">
                <div class="playoff-seed seed-${index + 1}">${index + 1}</div>
                <div>
                    <div class="font-semibold text-sm">${team.Owner}</div>
                    <div class="text-xs text-slate-400">${team.record}</div>
                </div>
            </div>
        `).join('');
    }
    
    function populateDashboard(data) {
      if (data.standings) {
        // First, transform owner names from the YAML to match JSON format
        const transformedStandings = data.standings.map(s => ({...s, Owner: s.team, record: s.record, Division: s.Division || 'N/A'}));
        populatePlayoffs(transformedStandings);
      }
        
      const highlightsContainer = document.getElementById('season-highlights');
      if (highlightsContainer && data.topPerformers) {
        highlightsContainer.innerHTML = `
          <div class="bg-slate-800/50 p-3 rounded">
            <div class="text-sm font-semibold text-yellow-400">üèÜ High Score</div>
            <div class="text-xs text-slate-300">${data.topPerformers.highestScorer.team}: ${data.topPerformers.highestScorer.points} pts (Week ${data.topPerformers.highestScorer.week})</div>
          </div>
          <div class="bg-slate-800/50 p-3 rounded">
            <div class="text-sm font-semibold text-green-400">‚öôÔ∏è Most Efficient</div>
            <div class="text-xs text-slate-300">${data.topPerformers.mostEfficient.team} (${data.topPerformers.mostEfficient.efficiency}%)</div>
          </div>
          <div class="bg-slate-800/50 p-3 rounded">
            <div class="text-sm font-semibold text-red-400">üíî Worst Beat</div>
            <div class="text-xs text-slate-300">${data.topPerformers.worstBeat.team}: Lost with ${data.topPerformers.worstBeat.points} pts (Week ${data.topPerformers.worstBeat.week})</div>
          </div>
        `;
      }
    }

    function getMockSeasonData() {
      return { /* ... your mock data ... */ };
    }

    function initializePage() {
      (async function loadSeasonData() {
        try {
          const response = await fetch('./data/season-stats.json');
          if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
          const seasonData = await response.json();
          // We need to merge in the Division data from the YAML logic
          // For now, let's manually add it for the script to work
          const divisionMap = { "FattyC26": "FLO", "healzyswarriors": "BTK", "coopersallstarz": "FLO", "Wicka": "BTK", "Sedgy": "FLO", "DaksDemons": "BTK", "MorgsLev13": "FLO", "gunga36": "BTK", "webbyt": "FLO", "3whits": "FLO", "JewTeam": "BTK", "Poddy": "BTK", "5yearRebuild": "BTK", "Stampy": "FLO", "MickyMayn": "FLO", "Bonzo22": "BTK" };
          seasonData.standings.forEach(s => s.Division = divisionMap[s.team]);
          populateDashboard(seasonData);
        } catch (error) {
          console.error('Could not load season data:', error);
          populateDashboard(getMockSeasonData());
        }
      })();
      
      const wrap = document.getElementById('weeks');
      if (wrap && typeof window.CUP_WEEKS !== 'undefined' && Array.isArray(window.CUP_WEEKS)) {
        const weeks = window.CUP_WEEKS;
        const maxWeek = weeks.reduce((m, w) => Math.max(m, w.week || 0), 0);
        
        wrap.innerHTML = '';
        weeks.forEach(w => {
            const a = document.createElement('a');
            a.className = 'card p-5 block hover:scale-[1.03] transition-transform duration-200';
            a.href = `${w.slug}.html`;
            a.innerHTML = `
                ${w.week === maxWeek ? '<div class="badge" aria-label="Newest">NEW</div>' : ''}
                <div class="text-xs uppercase tracking-wide text-slate-400">Week ${w.week}</div>
                <div class="mt-1 font-header text-2xl">${w.title}</div>
                <p class="mt-2 text-sm text-slate-300">${w.blurb ?? ""}</p>
            `;
            wrap.appendChild(a);
        });
      }
    }

    document.addEventListener('DOMContentLoaded', initializePage);
  </script>
</body>
</html>